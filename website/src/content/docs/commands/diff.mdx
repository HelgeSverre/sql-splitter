---
title: diff
description: Compare two SQL dumps for schema and data changes
---

Compare two SQL dump files to detect schema and data differences.

**Alias:** `df` (e.g., `sql-splitter df old.sql new.sql`)

## Usage

```bash
sql-splitter diff <OLD> <NEW> [OPTIONS]
```

## Examples

```bash
# Full comparison (schema + data)
sql-splitter diff old.sql new.sql

# Schema-only (fast)
sql-splitter diff old.sql new.sql --schema-only

# Data-only
sql-splitter diff old.sql new.sql --data-only

# Output formats
sql-splitter diff old.sql new.sql --format json -o diff.json
sql-splitter diff old.sql new.sql --format sql -o migration.sql

# Compare specific tables
sql-splitter diff old.sql new.sql --tables users,orders

# Verbose with sample PK values
sql-splitter diff old.sql new.sql --verbose

# Ignore timestamp columns
sql-splitter diff old.sql new.sql --ignore-columns "*.updated_at,*.created_at"

# Override primary key
sql-splitter diff old.sql new.sql --primary-key logs:timestamp+message
```

## Options

| Flag               | Short | Description                                 | Default     |
| ------------------ | ----- | ------------------------------------------- | ----------- |
| `--output`         | `-o`  | Output file                                 | stdout      |
| `--dialect`        | `-d`  | SQL dialect                                 | auto-detect |
| `--schema-only`    |       | Compare schema only                         | false       |
| `--data-only`      |       | Compare data only                           | false       |
| `--format`         | `-f`  | Output format: `text`, `json`, `sql`        | `text`      |
| `--tables`         | `-t`  | Only compare these tables                   | all         |
| `--exclude`        | `-e`  | Exclude these tables                        | none        |
| `--max-pk-entries` |       | Max PK entries to track                     | 10,000,000  |
| `--verbose`        | `-v`  | Show sample PK values                       | false       |
| `--primary-key`    |       | Override PK (format: `table:col1+col2`)     | auto        |
| `--ignore-order`   |       | Ignore column order differences             | false       |
| `--ignore-columns` |       | Ignore columns matching glob patterns       | none        |
| `--allow-no-pk`    |       | Compare tables without PK using all columns | false       |
| `--progress`       | `-p`  | Show progress bar                           | false       |

## What Diff Detects

**Schema changes:**

- Tables added/removed
- Columns added/removed/modified (type, nullability)
- Primary key changes
- Foreign key changes
- Index changes (CREATE INDEX, inline INDEX/KEY)

**Data changes:**

- Rows added/removed/modified
- Uses PK-based comparison for efficiency

## Output Formats

### Text (default)

```
Schema Changes:
  + Table 'audit_logs' added
  - Table 'temp_data' removed
  ~ Table 'users' modified:
    + Column 'phone' added (VARCHAR(20))
    ~ Column 'email' changed: VARCHAR(100) â†’ VARCHAR(255)

Data Changes:
  users: +5 added, -2 removed, ~10 modified
  orders: +100 added
```

### JSON

```json
{
  "schema": {
    "tables_added": ["audit_logs"],
    "tables_removed": ["temp_data"],
    "tables_modified": {
      "users": {
        "columns_added": [{ "name": "phone", "type": "VARCHAR(20)" }],
        "columns_modified": [
          { "name": "email", "old": "VARCHAR(100)", "new": "VARCHAR(255)" }
        ]
      }
    }
  },
  "data": {
    "users": { "added": 5, "removed": 2, "modified": 10 },
    "orders": { "added": 100, "removed": 0, "modified": 0 }
  }
}
```

### SQL Migration

```sql
-- Migration script generated by sql-splitter diff

ALTER TABLE users ADD COLUMN phone VARCHAR(20);
ALTER TABLE users MODIFY COLUMN email VARCHAR(255);

CREATE TABLE audit_logs (
  id INT PRIMARY KEY,
  ...
);

DROP TABLE temp_data;
```

## See Also

- [`validate`](/commands/validate) - Validate dump integrity
- [`convert`](/commands/convert) - Convert between dialects
