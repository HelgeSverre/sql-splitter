# sql-splitter

> High-performance CLI tool for splitting large SQL dump files into individual table files. Written in Go, achieves 300-400 MB/s throughput with constant ~100MB memory usage regardless of file size.

sql-splitter reads SQL dump files and routes statements to separate output files based on table name. It handles CREATE TABLE, INSERT INTO, CREATE INDEX, ALTER TABLE, and DROP TABLE statements.

## Key Features

- Streaming architecture handles files larger than available RAM
- Adaptive buffer sizing based on file size (64KB optimal for CPU cache)
- Concurrent writing with per-table writer pools
- Safe parsing of strings with escaped characters and multi-line statements
- Zero-allocation parsing using byte slices and sync.Pool

## Installation

```bash
go install github.com/helgesverre/sql-splitter@latest
```

## Commands

### split
Split a SQL file into individual table files.

```bash
sql-splitter split database.sql --output=tables
sql-splitter split database.sql --tables=users,posts  # filter specific tables
sql-splitter split database.sql --dry-run             # preview without writing
sql-splitter split database.sql --progress            # show progress
```

Flags:
- `--output, -o`: Output directory (default: "output")
- `--tables, -t`: Filter to specific tables (comma-separated)
- `--dry-run`: Preview what would be split without writing
- `--progress, -p`: Show progress during processing
- `--verbose, -v`: Verbose output

### analyze
Analyze a SQL file and display table statistics.

```bash
sql-splitter analyze database.sql
sql-splitter analyze database.sql --progress
```

## Supported Statement Types

- CREATE TABLE
- INSERT INTO
- CREATE INDEX
- ALTER TABLE
- DROP TABLE

Other statements (SELECT, UPDATE, DELETE) are skipped.

## Performance

Benchmarks on Apple M2 Max:
- Parser throughput: 327-411 MB/s
- Table extraction: 65 ns/op
- Memory usage: ~100 MB constant
- Cold start: ~10ms

## Documentation

- [README](https://github.com/helgesverre/sql-splitter/blob/main/README.md): Full documentation with architecture details
- [CLAUDE.md](https://github.com/helgesverre/sql-splitter/blob/main/CLAUDE.md): AI assistant guidance for working with the codebase

## Source Code

- [cmd/](https://github.com/helgesverre/sql-splitter/tree/main/cmd): CLI commands (root, split, analyze)
- [internal/parser/](https://github.com/helgesverre/sql-splitter/tree/main/internal/parser): Streaming SQL parser
- [internal/writer/](https://github.com/helgesverre/sql-splitter/tree/main/internal/writer): Buffered file writers with pool
- [internal/splitter/](https://github.com/helgesverre/sql-splitter/tree/main/internal/splitter): Split orchestration
- [internal/analyzer/](https://github.com/helgesverre/sql-splitter/tree/main/internal/analyzer): Statistical analysis

## Optional

- [CHANGELOG.md](https://github.com/helgesverre/sql-splitter/blob/main/CHANGELOG.md): Version history
- [LICENSE](https://github.com/helgesverre/sql-splitter/blob/main/LICENSE): MIT License
- [Makefile](https://github.com/helgesverre/sql-splitter/blob/main/Makefile): Build commands
