{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ConvertJsonOutput",
  "description": "JSON output for single file convert",
  "type": "object",
  "required": ["conversion", "dry_run", "input_file", "statistics", "warnings"],
  "properties": {
    "conversion": {
      "$ref": "#/definitions/ConversionInfo"
    },
    "dry_run": {
      "type": "boolean"
    },
    "input_file": {
      "type": "string"
    },
    "output_file": {
      "type": ["string", "null"]
    },
    "statistics": {
      "$ref": "#/definitions/ConvertStatistics"
    },
    "warnings": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ConvertWarning"
      }
    }
  },
  "definitions": {
    "ConversionInfo": {
      "type": "object",
      "required": ["from", "to"],
      "properties": {
        "from": {
          "type": "string"
        },
        "to": {
          "type": "string"
        }
      }
    },
    "ConvertStatistics": {
      "type": "object",
      "required": [
        "statements_converted",
        "statements_processed",
        "statements_skipped",
        "statements_unchanged"
      ],
      "properties": {
        "statements_converted": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0.0
        },
        "statements_processed": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0.0
        },
        "statements_skipped": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0.0
        },
        "statements_unchanged": {
          "type": "integer",
          "format": "uint64",
          "minimum": 0.0
        }
      }
    },
    "ConvertWarning": {
      "description": "Warning types that can occur during conversion",
      "oneOf": [
        {
          "description": "Feature not supported in target dialect",
          "type": "object",
          "required": ["feature", "type"],
          "properties": {
            "feature": {
              "type": "string"
            },
            "suggestion": {
              "type": ["string", "null"]
            },
            "type": {
              "type": "string",
              "enum": ["unsupported_feature"]
            }
          }
        },
        {
          "description": "Data type conversion may lose precision",
          "type": "object",
          "required": ["from_type", "to_type", "type"],
          "properties": {
            "column": {
              "type": ["string", "null"]
            },
            "from_type": {
              "type": "string"
            },
            "table": {
              "type": ["string", "null"]
            },
            "to_type": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": ["lossy_conversion"]
            }
          }
        },
        {
          "description": "Statement was skipped",
          "type": "object",
          "required": ["reason", "statement_preview", "type"],
          "properties": {
            "reason": {
              "type": "string"
            },
            "statement_preview": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": ["skipped_statement"]
            }
          }
        },
        {
          "description": "COPY statement needs conversion (PostgreSQL)",
          "type": "object",
          "required": ["table", "type"],
          "properties": {
            "table": {
              "type": "string"
            },
            "type": {
              "type": "string",
              "enum": ["copy_not_converted"]
            }
          }
        }
      ]
    }
  }
}
